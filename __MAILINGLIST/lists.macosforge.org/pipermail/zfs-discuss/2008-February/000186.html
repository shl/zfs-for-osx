<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [zfs-discuss] Questions from someone new to ZFS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Questions%20from%20someone%20new%20to%20ZFS&In-Reply-To=1CCB868B-26B1-4BD4-ACC7-B3323E2E3207%40nrao.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000185.html">
   <LINK REL="Next"  HREF="000184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[zfs-discuss] Questions from someone new to ZFS</H1>
    <B>Bryan Hill</B> 
    <A HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Questions%20from%20someone%20new%20to%20ZFS&In-Reply-To=1CCB868B-26B1-4BD4-ACC7-B3323E2E3207%40nrao.edu"
       TITLE="[zfs-discuss] Questions from someone new to ZFS">bhill at physics.ucsd.edu
       </A><BR>
    <I>Thu Feb 21 13:55:25 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000185.html">[zfs-discuss] Questions from someone new to ZFS
</A></li>
        <LI>Next message: <A HREF="000184.html">[zfs-discuss] encryption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Feb 21, 2008, at 12:43 PM, Boyd Waters wrote:

&gt;<i>
</I>&gt;<i> On Feb 21, 2008, at 10:13 AM, Bryan Hill wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I'm using HFS+ for the current mail store in our setup.  Its
</I>&gt;&gt;<i> performance isn't so great with millions of tiny files.  I'm hoping
</I>&gt;&gt;<i> ZFS deals with this more efficiently.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have to be careful when I'm talking about filesystem &quot;performance&quot;
</I>&gt;<i> and &quot;millions of tiny files&quot;; I discovered the hard way that most GNU
</I>&gt;<i> user-land tools sort the result of filesystem calls such as readdir()
</I>&gt;<i> using a method that will roll on the floor twitching if the result is
</I>&gt;<i> more than a thousand or so entries.
</I>&gt;<i>
</I>&gt;<i> So for instance doing an &quot;ls bigDir&quot; where bigDir contains 30000 files
</I>&gt;<i> - tiny or not - will hammer the CPU, and not print anything on the
</I>&gt;<i> screen, until after your coffee break is over.
</I>&gt;<i>
</I>&gt;<i> Such nonsense has nothing to do with the filesystem layer. It won't
</I>&gt;<i> matter (much) if that bigDir is on HFS+ or ZFS.
</I>&gt;<i>
</I>&gt;<i> So be careful out there!
</I>

This is exactly what I see with HFS+ (journaled and case-sensitive).   
The mail store is on its own RAID 5 volume, which I call /Volumes/spool

Under this, I have the directory structure imap/user/&lt;username&gt; for  
each user's mail drop.  A user's folder can contain tens of thousands  
of files and various IMAP subfolders.  Right now, doing an &quot;ls -l&quot; on  
a user who might have, say, 45000 messages in his/her INBOX or  
subfolder can take a while.  One of the things that bug me is that if  
I copy the entire mail store to a freshly created volume, the  
performance is &quot;good&quot; in that  doing an &quot;ls -l&quot; is relatively quick,  
maybe 10-20 seconds.  After a few months or so, doing an ls on the  
same folder with about the same number of files will take possibly a  
minute or two.

Copying the data from one volume to another takes hours.  I currently  
have about 240GB of files that can take over 6 hours to copy off to  
another drive.  After the copy, if reformat the source partition and  
copy the data back, it takes about 3 hours.  Again, the &quot;good&quot;  
performance returns but degrades over time.

Is this typical in what one would experience regardless of filesystem  
type?

Thanks,
Bryan

---
Bryan D. Hill
UCSD Physics Computing Facilty
9500 Gilman Dr.  # 0319
La Jolla, CA 92093
858-534-5538
<A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">bhill at ucsd.edu</A>
AIM:  pozvibesd
Web:  <A HREF="http://www.physics.ucsd.edu/pcf">http://www.physics.ucsd.edu/pcf</A>





</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000185.html">[zfs-discuss] Questions from someone new to ZFS
</A></li>
	<LI>Next message: <A HREF="000184.html">[zfs-discuss] encryption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">More information about the zfs-discuss
mailing list</a><br>
</body></html>
