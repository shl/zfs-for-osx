<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [zfs-discuss] Kernel Panics
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Kernel%20Panics&In-Reply-To=0A113794-353C-45B6-AA9E-C994C3CAC03C%40apple.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000388.html">
   <LINK REL="Next"  HREF="000397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[zfs-discuss] Kernel Panics</H1>
    <B>James R. Van Artsdalen</B> 
    <A HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Kernel%20Panics&In-Reply-To=0A113794-353C-45B6-AA9E-C994C3CAC03C%40apple.com"
       TITLE="[zfs-discuss] Kernel Panics">james-zfsosx at jrv.org
       </A><BR>
    <I>Fri Apr  4 16:29:56 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000388.html">[zfs-discuss] Kernel Panics
</A></li>
        <LI>Next message: <A HREF="000397.html">[zfs-discuss] Kernel Panics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>No&#235;l Dellofano wrote:
&gt;<i> This panic is from a device either being removed or failing to 
</I>&gt;<i> respond.  Since ZFS is trying to write to it and it's a non replicated 
</I>&gt;<i> pool, then the write *not* flagged as ZIO_FLAG_CANFAIL.  Since the 
</I>&gt;<i> write must succeed and the drive appears to either be missing or 
</I>&gt;<i> malfunctioning, then a panic ensues.  We are working on changing this 
</I>&gt;<i> behaviour such that instead of panicking we will handle this error 
</I>&gt;<i> more gracefully while still trying to maintain on disk consistency.
</I>&gt;<i>
</I>I don't understand this.  The on-disk format is always consistent, 
right?  As I understand it that failed write can be discarded (so long 
as subsequent I/O is not written!) and the on-disk image remains 
consistent?  I'm having trouble seeing how this &quot;write failure&quot; event 
differs from a &quot;loss of power&quot; event as far as on-disk consistency goes.


As an aside, I assume ZFS requires the underlying devices honor either 
write fencing or ordering of some kind in order to keep the on-disk 
structures consistent.  Is it known that the Firewire and USB drivers in 
OSX honor this requirement?

I have had a couple of data loss / pool corruption events experimenting 
with ZFS on FreeBSD in a VMware machine on OSX.  My assumption is that 
VMware is not passing through some write-fencing from ZFS/FreeBSD to OSX 
correctly.  But I'm wondering if the OSX drivers have been looked at to 
make sure whatever it is ZFS needs is met by current OSX drivers.  What 
the disk drive itself does to fenced/ordered writes is another problem 
entirely...

I haven't had any data loss or data corruption under OSX yet, nor any 
panics (but then again I have 4GB of RAM) with correctly labeled disks.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000388.html">[zfs-discuss] Kernel Panics
</A></li>
	<LI>Next message: <A HREF="000397.html">[zfs-discuss] Kernel Panics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.macosforge.org/mailman/listinfo/zfs-discuss">More information about the zfs-discuss
mailing list</a><br>
</body></html>
