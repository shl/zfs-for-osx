<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [zfs-discuss] build-119 still dying a silent death
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20build-119%20still%20dying%20a%20silent%20death&In-Reply-To=7CE95A44-0635-4003-B009-B7D93209DC59%40apple.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000712.html">
   <LINK REL="Next"  HREF="000717.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[zfs-discuss] build-119 still dying a silent death</H1>
    <B>Jonathan Edwards</B> 
    <A HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20build-119%20still%20dying%20a%20silent%20death&In-Reply-To=7CE95A44-0635-4003-B009-B7D93209DC59%40apple.com"
       TITLE="[zfs-discuss] build-119 still dying a silent death">Jonathan.Edwards at Sun.COM
       </A><BR>
    <I>Tue Jul 22 13:27:49 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000712.html">[zfs-discuss] build-119 still dying a silent death
</A></li>
        <LI>Next message: <A HREF="000717.html">[zfs-discuss] build-119 still dying a silent death
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#715">[ date ]</a>
              <a href="thread.html#715">[ thread ]</a>
              <a href="subject.html#715">[ subject ]</a>
              <a href="author.html#715">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>i was able to reproduce a hard hang on a much smaller system config ..
just 4 x 64MB files here for my test pool .. compression doesn't matter:

bash-3.2# zpool status -v
   pool: tpool
  state: ONLINE
  scrub: none requested
config:

	NAME              STATE     READ WRITE CKSUM
	tpool             ONLINE       0     0     0
	  /var/tmp/file1  ONLINE       0     0     0
	  /var/tmp/file2  ONLINE       0     0     0
	  /var/tmp/file3  ONLINE       0     0     0
	  /var/tmp/file4  ONLINE       0     0     0

errors: No known data errors
bash-3.2# rsync --version
rsync  version 2.6.3  protocol version 28
Copyright (C) 1996-2004 by Andrew Tridgell and others
&lt;<A HREF="http://rsync.samba.org/">http://rsync.samba.org/</A>&gt;
Capabilities: 64-bit files, socketpairs, hard links, symlinks,  
batchfiles,
               inplace, IPv6, 32-bit system inums, 64-bit internal inums

---
i'll have to figure out how to do a kdb equiv to get a backtrace here

of note .. i also saw a vfs error last night on shutdown that also  
resulted in a hard hang:

Tue Jul 22 01:17:08 2008
panic(cpu 1 caller 0x001DBC3D): &quot;vnode_put(0x529dc70): iocount &lt; 1&quot;@/ 
SourceCache/xnu/xnu-1228.5.20/bsd/vfs/vfs_subr.c:3581
Backtrace, Format - Frame : Return Address (4 potential args on stack)
0x475dfd78 : 0x12b0fa (0x4592a4 0x475dfdac 0x133243 0x0)
0x475dfdc8 : 0x1dbc3d (0x467410 0x529dc70 0x475dfe08 0x4792d532)
0x475dfde8 : 0x1dbcee (0x529dc70 0x6f17220 0xf9bdf8ae 0x1064f140)
0x475dfe08 : 0x478fd30b (0x529dc70 0x479602e4 0x0 0x0)
0x475dff58 : 0x478e60a2 (0x1064f000 0xc81d 0x0 0x0)
0x475dffc8 : 0x19ebdc (0x1023d200 0x0 0x1a20b5 0x5a8f3c8)
Backtrace terminated-invalid frame pointer 0
       Kernel loadable modules in backtrace (with dependencies):
          com.apple.filesystems.zfs(8.0)@0x478b5000-&gt;0x47980fff

BSD process name corresponding to current thread: kernel_task

Mac OS version:
9E17

Kernel version:
Darwin Kernel Version 9.4.0: Mon Jun  9 19:30:53 PDT 2008;  
root:xnu-1228.5.20~1/RELEASE_I386
System model name: MacBookPro2,2 (Mac-F42187C8)

----
also could we up the version number in the zfs module plist to track  
version problems a little better?
methinks (8.0) is the default template for a kext

would also be nice to get some sort of web bugtraq in place so we can  
just file 'em

---
.je

On Jul 22, 2008, at 3:23 PM, No&#235;l Dellofano wrote:

&gt;<i> Neat!  I haven't seen this issue since fixing the memory scaling bug a
</I>&gt;<i> while ago.  Sorry to hear it's giving you troubles.
</I>&gt;<i>
</I>&gt;<i> Germano,
</I>&gt;<i> if it reproduces, then the snapshot would be awesome!  As my biggest
</I>&gt;<i> issue is getting stuff like that to reproduce in house.  So you're
</I>&gt;<i> just using standard leopard shipped rsync right?  If so, since he's
</I>&gt;<i> the fatty that tries to shove everything in memory I wonder if we're
</I>&gt;<i> stuck sleeping waiting for someone to give up some memory possibly and
</I>&gt;<i> are wedged...
</I>&gt;<i>
</I>&gt;<i> as usual you guys are the best test team a girl can have :)  If your
</I>&gt;<i> snapshot works send it over.  Otherwise I'll do my best to mimic your
</I>&gt;<i> system and see if I can get a recreate..
</I>&gt;<i>
</I>&gt;<i> thanks!
</I>&gt;<i> Noel
</I>&gt;<i>
</I>&gt;<i> On Jul 22, 2008, at 12:08 PM, Boyd Waters wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Jul 22, 2008, at 11:02 AM, Germano Caronni wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If I do a recursive diff on some of these trees, or a find and a
</I>&gt;&gt;&gt;<i> following md5 sum on, say, 100'000+ files, the machine will die the
</I>&gt;&gt;&gt;<i> same silent death as reported for excessive rsync before
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Interesting!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not seeing that problem any more, but I've been using rsync  
</I>&gt;&gt;<i> 3.0.4,
</I>&gt;&gt;<i> built from source, 64-bit... it's dramatically improved over the
</I>&gt;&gt;<i> version that ships with Leopard.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wonder if there's a memory leak in the VFS layer.  (wow, that  
</I>&gt;&gt;<i> almost
</I>&gt;&gt;<i> sounds like I know what I'm talking about, but really I don't)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> zfs-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">zfs-discuss at lists.macosforge.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> zfs-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">zfs-discuss at lists.macosforge.org</A>
</I>&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000712.html">[zfs-discuss] build-119 still dying a silent death
</A></li>
	<LI>Next message: <A HREF="000717.html">[zfs-discuss] build-119 still dying a silent death
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#715">[ date ]</a>
              <a href="thread.html#715">[ thread ]</a>
              <a href="subject.html#715">[ subject ]</a>
              <a href="author.html#715">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">More information about the zfs-discuss
mailing list</a><br>
</body></html>
