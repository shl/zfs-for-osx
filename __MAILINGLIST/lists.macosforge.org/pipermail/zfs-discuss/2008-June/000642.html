<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [zfs-discuss] Tracking random failures on a ZFS volume
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Tracking%20random%20failures%20on%20a%20ZFS%20volume&In-Reply-To=B99DA273-7FF4-4161-9B29-564BD1F4A25C%40halfpast.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000641.html">
   <LINK REL="Next"  HREF="000644.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[zfs-discuss] Tracking random failures on a ZFS volume</H1>
    <B>Andrei Dorofeev</B> 
    <A HREF="mailto:zfs-discuss%40lists.macosforge.org?Subject=%5Bzfs-discuss%5D%20Tracking%20random%20failures%20on%20a%20ZFS%20volume&In-Reply-To=B99DA273-7FF4-4161-9B29-564BD1F4A25C%40halfpast.net"
       TITLE="[zfs-discuss] Tracking random failures on a ZFS volume">dorofeev at gmail.com
       </A><BR>
    <I>Mon Jun 16 17:55:44 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000641.html">[zfs-discuss] Tracking random failures on a ZFS volume
</A></li>
        <LI>Next message: <A HREF="000644.html">[zfs-discuss] Tracking random failures on a ZFS volume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've seeing very similar problems with &quot;rm -rf&quot; failing in some cases.
Looks like we might be getting stale reference counts on some files or
directories.

I've also noticed that sometimes copying directory off of HFS+ volume
onto ZFS volume where directory with the same name have existed
previously but was removed can fail. It doesn't happen always, but the
workaround that seems to work is to just copy it again and then it
succeeds.

We need to come up with simple to reproduce tests for these kind
of failures and send them to Apple ZFS folks.

- Andrei

On Mon, Jun 16, 2008 at 5:38 PM, Jon Moog &lt;<A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">jon at halfpast.net</A>&gt; wrote:
&gt;<i> I have noticed that there have been a number of references to this
</I>&gt;<i> list for odd behavior surrounding directory creation/deletion.
</I>&gt;<i> Specifically MacPorts build failures and trouble with phantom
</I>&gt;<i> directories that won't allow themselves to be deleted.
</I>&gt;<i>
</I>&gt;<i> Adding to that list is another odd occurrence that seems to be
</I>&gt;<i> related. In a rather full directory hierarchy I have found that doing
</I>&gt;<i> an rm -rf will sometimes generate the following:
</I>&gt;<i>
</I>&gt;<i> rm: AddOns/FuBar_TopScoreFu/Libs: Directory not empty
</I>&gt;<i> rm: AddOns/FuBar_TopScoreFu: Directory not empty
</I>&gt;<i> rm: AddOns: Directory not empty
</I>&gt;<i>
</I>&gt;<i> Odd since the force option shouldn't generate many complaints and of
</I>&gt;<i> course the recurse option should be getting children before parents.
</I>&gt;<i>
</I>&gt;<i> Doing the same rm -rf a second time a bit later succeeds fine.
</I>&gt;<i>
</I>&gt;<i> I first noticed this when trying to remove the contents of .Trashes.
</I>&gt;<i> In that case a couple of repeated (rather impatiently) rm -rf got the
</I>&gt;<i> same errors. Manually checking each of the directories with ls, then
</I>&gt;<i> repeating the rm -rf worked fine.
</I>&gt;<i>
</I>&gt;<i> I can see this being a problem with any utility that rapidly creates
</I>&gt;<i> and destroys directories/files and isn't diligent about testing for
</I>&gt;<i> errors.
</I>&gt;<i>
</I>&gt;<i> So two questions. Is this a known issue? If it isn't is there anything
</I>&gt;<i> specific that might help track it down from a debugging perspective
</I>&gt;<i> that I could provide.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i> -Jon
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> zfs-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">zfs-discuss at lists.macosforge.org</A>
</I>&gt;<i> <A HREF="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss</A>
</I>&gt;<i>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000641.html">[zfs-discuss] Tracking random failures on a ZFS volume
</A></li>
	<LI>Next message: <A HREF="000644.html">[zfs-discuss] Tracking random failures on a ZFS volume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.macosforge.org/mailman/listinfo.cgi/zfs-discuss">More information about the zfs-discuss
mailing list</a><br>
</body></html>
